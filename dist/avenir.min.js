!(function(n, t) {
  "object" == typeof exports && "undefined" != typeof module
    ? t(exports)
    : "function" == typeof define && define.amd
      ? define(["exports"], t)
      : t((n.Avenir = {}));
})(this, function(n) {
  "use strict";
  function t(n) {
    var t = void 0;
    return function(r, e) {
      return function(u) {
        if (!t) return (t = !0), r(u);
        if (e)
          throw new TypeError(
            e + ". Status: " + n._status + ", value :" + n._value
          );
      };
    };
  }
  var r = function(n) {
      return "function" == typeof n;
    },
    e = function() {},
    u = function(n) {
      throw n;
    },
    o = function(n, t) {
      var r = n.slice();
      return r.push(t), r;
    },
    i = 1,
    c = {
      disable: function() {
        return (i = 0);
      },
      enableInfos: function() {
        return (i = 3);
      },
      enableWarnings: function() {
        return (i = 2);
      },
      info: function(n) {
        3 > i || console.info(n);
      },
      warn: function(n) {
        2 > i || console.warn(n);
      },
      error: function(n) {
        1 > i || console.error(n && n.message ? n.message : n);
      }
    },
    f = function(n, t) {
      if (!n) {
        var r = new TypeError(t);
        throw (c.error(r), r);
      }
    },
    s = function(n) {
      f(r(n), "argument is not a function");
    },
    a = function(n, t) {
      if (!(n instanceof t))
        throw new TypeError("Cannot call a class as a function");
    },
    l = (function() {
      function n(n, t) {
        for (var r = 0; t.length > r; r++) {
          var e = t[r];
          (e.enumerable = e.enumerable || !1), (e.configurable = !0), "value" in
            e && (e.writable = !0), Object.defineProperty(n, e.key, e);
        }
      }
      return function(t, r, e) {
        return r && n(t.prototype, r), e && n(t, e), t;
      };
    })(),
    v = "PENDING",
    h = "RESOLVED",
    p = "REJECTED",
    _ = "CANCELLED",
    d = function(n) {
      return f(n instanceof y, "argument is not a Future");
    },
    y = (function() {
      function n(r) {
        var e = this;
        a(this, n), s(r), (this._joiners = new Set()), (this._status = v);
        var u = t(this);
        this._dispose = r(
          u(function(n) {
            return e._force(h, n);
          }),
          u(function(n) {
            return e._force(p, n);
          }),
          u(function(n) {
            return e._force(_, n);
          })
        );
      }
      return (n.prototype.subscribe = function() {
        var n =
            arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : e,
          t = this,
          r =
            arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : e,
          u =
            arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : e;
        if ((s(n), s(r), s(u), this._status === v)) {
          var o = { onSuccess: n, onError: r, onCancel: u };
          return this._joiners.add(o), function() {
            t._joiners && t._joiners.delete(o);
          };
        }
        return this._notify(n, r, u), e;
      }), (n.prototype.fork = function() {
        var t = this;
        return new n(function(n, r, e) {
          return t.subscribe(n, r, e);
        });
      }), (n.prototype.cancel = function(n) {
        this._status === v &&
          (this._dispose && this._dispose(n), this._force(_, n));
      }), (n.prototype.then = function(t, r, e) {
        var u = this;
        return t && s(t), r && s(r), e && s(e), new n(function(o, i, c) {
          var f = void 0,
            s = void 0,
            a = function(t) {
              return function(r) {
                var e = t(r);
                e instanceof n ? (s = e.subscribe(o, i, c)) : o(e);
              };
            };
          return (f = u.subscribe(
            t ? a(t) : o,
            r ? a(r) : i,
            e ? a(e) : c
          )), function() {
            f && f(), s && s();
          };
        });
      }), (n.prototype.orElse = function(t) {
        d(t);
        var r = this;
        return r._status === h || r._status === p
          ? r
          : r._status === _ || t._status !== v
            ? t
            : new n(function(n, e, u) {
                function o(t) {
                  f(), n(t);
                }
                function i(n) {
                  f(), e(n);
                }
                function c(n) {
                  r._status === _ && t._status === _ && (u(n), f());
                }
                function f() {
                  s && s(), a && a();
                }
                var s = r.subscribe(o, i, c),
                  a = t.subscribe(o, i, c);
                return f;
              });
      }), (n.of = function(t) {
        return new n(function(n) {
          return n(t);
        });
      }), (n.resolve = function(t) {
        return n.of(t);
      }), (n.reject = function(t) {
        return new n(function(n, r) {
          return r(t);
        });
      }), (n.cancel = function(t) {
        return new n(function(n, r, e) {
          return e(t);
        });
      }), (n.empty = function() {
        return b;
      }), (n.zipw = function(t, r, e) {
        return s(t), d(r), d(e), r._status === h && e._status === h
          ? n.resolve(t(r._value, e._value))
          : r._status === p || r._status === _
            ? r
            : e._status === p || e._status === _
              ? e
              : new n(function(n, u, o) {
                  function i() {
                    r._status === h &&
                      e._status === h &&
                      n(t(r._value, e._value));
                  }
                  function c(n) {
                    u(n), s();
                  }
                  function f(n) {
                    o(n), s();
                  }
                  function s() {
                    a && a(), l && l();
                  }
                  var a = r.subscribe(i, c, f),
                    l = e.subscribe(i, c, f);
                  return s;
                });
      }), (n.all = function(t) {
        return t.forEach(d), t.reduce(w, n.resolve([]));
      }), (n.race2 = function(n, t) {
        return d(n), d(t), n.orElse(t);
      }), (n.race = function(t) {
        return f(
          t && t.length,
          "argument must be a non empty array"
        ), t.forEach(d), t.reduce(n.race2);
      }), (n.lift2 = function(t) {
        return function(r, e) {
          return n.zipw(t, r, e);
        };
      }), (n.defer = function() {
        var t = void 0,
          r = void 0,
          e = void 0;
        return {
          future: new n(function(n, u, o) {
            (t = n), (r = u), (e = o);
          }),
          resolve: t,
          reject: r,
          cancel: e
        };
      }), (n.prototype._notify = function(n, t, r) {
        var e = this._status,
          u = this._value;
        e === h ? n(u) : e === p ? t(u) : e === _ && r(u);
      }), (n.prototype._force = function(n, t) {
        var r = this;
        if (this._status === v) {
          (this._status = n), (this._value = t);
          var e = this._joiners;
          (this._joiners = null), e.forEach(function(n) {
            var t = n.onSuccess,
              e = n.onError,
              u = n.onCancel;
            return r._notify(t, e, u);
          });
        }
      }), (n.prototype._complete = function(n) {
        this._force(h, n);
      }), (n.prototype._abort = function(n) {
        this._force(p, n);
      }), l(n, [
        {
          key: "status",
          get: function() {
            return this._status;
          }
        },
        {
          key: "value",
          get: function() {
            return this._value;
          }
        }
      ]), n;
    })(),
    w = y.lift2(o),
    b = new y(function() {}),
    E = function(n) {
      return f(n instanceof m, "argument is not a Task");
    },
    m = (function() {
      function n(t) {
        a(this, n), (this.fork = t);
      }
      return (n.prototype.run = function() {
        var n =
            arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : e,
          t =
            arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : u,
          r =
            arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : e;
        s(n), s(t), s(r);
        var o = this.fork();
        return o.subscribe(n, t, r), o;
      }), (n.prototype.orElse = function(t) {
        var r = this;
        return E(t), this === k
          ? t
          : t === k
            ? this
            : new n(function() {
                function n(n, t) {
                  e.cancel(t), u.cancel(t);
                }
                var e = r.fork();
                if ("PENDING" !== e.status) return e;
                var u = t.fork(),
                  o = e.orElse(u);
                return o.subscribe(n, n, function(t) {
                  return n(0, t);
                }), o;
              });
      }), (n.prototype.then = function(t, r, e) {
        var u = this;
        return t && s(t), r && s(r), e && s(e), this === k
          ? k
          : new n(function() {
              function o(n, t) {
                i.cancel(t), c && c.cancel(t);
              }
              var i = void 0,
                c = void 0,
                f = function(t) {
                  return function(r) {
                    var e = t(r);
                    return e instanceof n ? (c = e.fork()) : e;
                  };
                };
              t && (t = f(t)), r && (r = f(r)), e && (e = f(e));
              var s = (i = u.fork()).then(t, r, e);
              return s.subscribe(void 0, o, function(n) {
                return o(0, n);
              }), s;
            });
      }), (n.prototype.log = function(n) {
        return this.run(
          function(t) {
            return console.log(n, ": resolved with ", t);
          },
          function(t) {
            return console.error(n, ": rejected with ", t);
          },
          function(t) {
            return console.log(n, ": cancelled with ", t);
          }
        );
      }), (n.of = function(t) {
        return n.from(function(n) {
          return n(t);
        });
      }), (n.resolve = function(t) {
        return n.from(function(n) {
          return n(t);
        });
      }), (n.reject = function(t) {
        return n.from(function(n, r) {
          return r(t);
        });
      }), (n.cancel = function(t) {
        return n.from(function(n, r, e) {
          return e(t);
        });
      }), (n.from = function(t) {
        return s(t), new n(function() {
          return new y(t);
        });
      }), (n.join = function(t) {
        return new n(function() {
          return t.fork();
        });
      }), (n.empty = function() {
        return k;
      }), (n.race2 = function(n, t) {
        return E(n), E(t), n.orElse(t);
      }), (n.race = function(t) {
        return t.forEach(E), t.reduce(n.race2, k);
      }), (n.zipw = function(t, r, e) {
        return s(t), E(r), E(e), r === k || e === k
          ? k
          : new n(function() {
              function n(n, t) {
                u.cancel(t), o.cancel(t);
              }
              var u = r.fork();
              if ("CANCELLED" === u.status || "REJECTED" === u.status) return u;
              var o = e.fork(),
                i = y.zipw(t, u, o);
              return i.subscribe(n, n, function(t) {
                return n(0, t);
              }), i;
            });
      }), (n.all = function(t) {
        return t.forEach(E), t.reduce(g, n.of([]));
      }), (n.traverse = function(t, r) {
        return s(t), n.all(r.then(t));
      }), (n.detect = function(t, r) {
        return s(t), n.race(
          r.map(function(r) {
            return r.then(function(r) {
              return t(r).then(function(t) {
                return t ? n.of(r) : k;
              });
            });
          })
        );
      }), (n.apply = function(t, r, e) {
        return s(t), n.all(r).map(function(n) {
          return t.apply(e, n);
        });
      }), (n.lift2 = function(t) {
        return s(t), function(r, e) {
          return n.zipw(t, r, e);
        };
      }), (n.lift = function(t) {
        return s(t), function() {
          for (var r = arguments.length, e = Array(r), u = 0; r > u; u++)
            e[u] = arguments[u];
          return n.apply(t, e);
        };
      }), (n.do = function(t) {
        return new n(function() {
          function n(t, e) {
            try {
              var u = e ? r.throw(t) : r.next(t),
                o = u.value;
              return u.done
                ? y.of(o)
                : o.fork().then(
                    function(t) {
                      return n(t);
                    },
                    function(t) {
                      return n(t, !0);
                    },
                    function(n) {
                      return r.return(n), y.cancel(n);
                    }
                  );
            } catch (n) {
              return y.reject(n);
            }
          }
          var r = t();
          return n();
        });
      }), n;
    })(),
    g = m.lift2(o),
    k = new m(y.empty),
    j = (n.delayF = function(n, t) {
      return new y(function(r) {
        var e = setTimeout(function() {
          return r(t);
        }, n);
        return function() {
          clearTimeout(e);
        };
      });
    });
  (n.Task = m), (n.Future = y), (n.delay = function(n, t) {
    return new m(function() {
      return j(n, t);
    });
  }), Object.defineProperty(n, "__esModule", { value: !0 });
});
